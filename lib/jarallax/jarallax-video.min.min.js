/*!
 * Name    : Video Worker (wrapper for Youtube, Vimeo and Local videos)
 * Version : 1.2.1
 * Author  : _nK https://nkdev.info
 * GitHub  : https://github.com/nk-o/jarallax
 */
(function(p){function o(b){b=b||{};for(var c=1;c<arguments.length;c++){if(!arguments[c]){continue}for(var a in arguments[c]){if(arguments[c].hasOwnProperty(a)){b[a]=arguments[c][a]}}}return b}function n(){this._done=[];this._fail=[]}n.prototype={execute:function(c,b){var a=c.length;b=Array.prototype.slice.call(b);while(a--){c[a].apply(null,b)}},resolve:function(){this.execute(this._done,arguments)},reject:function(){this.execute(this._fail,arguments)},done:function(a){this._done.push(a)},fail:function(a){this._fail.push(a)}};function t(c,b,a){if(c.addEventListener){c.addEventListener(b,a)}else{c.attachEvent("on"+b,function(){a.call(c)})}}var r=(function(){var b=0;function a(d,e){var c=this;c.url=d;c.options_default={autoplay:1,loop:1,mute:1,controls:0,startTime:0,endTime:0};c.options=o({},c.options_default,e);c.videoID=c.parseURL(d);if(c.videoID){c.ID=b++;c.loadAPI();c.init()}}return a}());r.prototype.parseURL=function(a){function f(h){var i=/.*(?:youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=)([^#\&\?]*).*/;var j=h.match(i);return j&&j[1].length===11?j[1]:false}function e(h){var i=/https?:\/\/(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/([^\/]*)\/videos\/|album\/(\d+)\/video\/|video\/|)(\d+)(?:$|\/|\?)/;var j=h.match(i);return j&&j[3]?j[3]:false}function g(h){var y=h.split(/,(?=mp4\:|webm\:|ogv\:|ogg\:)/);var z={};var i=0;for(var k=0;k<y.length;k++){var j=y[k].match(/^(mp4|webm|ogv|ogg)\:(.*)/);if(j&&j[1]&&j[2]){z[j[1]==="ogv"?"ogg":j[1]]=j[2];i=1}}return i?z:false}var b=f(a);var d=e(a);var c=g(a);if(b){this.type="youtube";return b}else{if(d){this.type="vimeo";return d}else{if(c){this.type="local";return c}}}return false};r.prototype.isValid=function(){return !!this.videoID};r.prototype.on=function(b,a){this.userEventsList=this.userEventsList||[];(this.userEventsList[b]||(this.userEventsList[b]=[])).push(a)};r.prototype.off=function(a,c){if(!this.userEventsList||!this.userEventsList[a]){return}if(!c){delete this.userEventsList[a]}else{for(var b=0;b<this.userEventsList[a].length;b++){if(this.userEventsList[a][b]===c){this.userEventsList[a][b]=false}}}};r.prototype.fire=function(c){var a=[].slice.call(arguments,1);if(this.userEventsList&&typeof this.userEventsList[c]!=="undefined"){for(var b in this.userEventsList[c]){if(this.userEventsList[c][b]){this.userEventsList[c][b].apply(this,a)}}}};r.prototype.play=function(a){var b=this;if(!b.player){return}if(b.type==="youtube"&&b.player.playVideo){if(typeof a!=="undefined"){b.player.seekTo(a||0)}b.player.playVideo()}if(b.type==="vimeo"){if(typeof a!=="undefined"){b.player.setCurrentTime(a)}b.player.getPaused().then(function(c){if(c){b.player.play()}})}if(b.type==="local"){if(typeof a!=="undefined"){b.player.currentTime=a}b.player.play()}};r.prototype.pause=function(){if(!this.player){return}if(this.type==="youtube"&&this.player.pauseVideo){this.player.pauseVideo()}if(this.type==="vimeo"){this.player.pause()}if(this.type==="local"){this.player.pause()}};r.prototype.getImageURL=function(c){var d=this;if(d.videoImage){c(d.videoImage);return}if(d.type==="youtube"){var e=["maxresdefault","sddefault","hqdefault","0"];var f=0;var a=new Image();a.onload=function(){if((this.naturalWidth||this.width)!==120||f===e.length-1){d.videoImage="https://img.youtube.com/vi/"+d.videoID+"/"+e[f]+".jpg";c(d.videoImage)}else{f++;this.src="https://img.youtube.com/vi/"+d.videoID+"/"+e[f]+".jpg"}};a.src="https://img.youtube.com/vi/"+d.videoID+"/"+e[f]+".jpg"}if(d.type==="vimeo"){var b=new XMLHttpRequest();b.open("GET","https://vimeo.com/api/v2/video/"+d.videoID+".json",true);b.onreadystatechange=function(){if(this.readyState===4){if(this.status>=200&&this.status<400){var g=JSON.parse(this.responseText);d.videoImage=g[0].thumbnail_large;c(d.videoImage)}else{}}};b.send();b=null}};r.prototype.getIframe=function(a){var b=this;if(b.$iframe){a(b.$iframe);return}b.onAPIready(function(){var c;if(!b.$iframe){c=document.createElement("div");c.style.display="none"}if(b.type==="youtube"){b.playerOptions={};b.playerOptions.videoId=b.videoID;b.playerOptions.playerVars={autohide:1,rel:0,autoplay:0};if(!b.options.controls){b.playerOptions.playerVars.iv_load_policy=3;b.playerOptions.playerVars.modestbranding=1;b.playerOptions.playerVars.controls=0;b.playerOptions.playerVars.showinfo=0;b.playerOptions.playerVars.disablekb=1}var i;var h;b.playerOptions.events={onReady:function(x){if(b.options.mute){x.target.mute()}if(b.options.autoplay){b.play(b.options.startTime)}b.fire("ready",x)},onStateChange:function(x){if(b.options.loop&&x.data===YT.PlayerState.ENDED){b.play(b.options.startTime)}if(!i&&x.data===YT.PlayerState.PLAYING){i=1;b.fire("started",x)}if(x.data===YT.PlayerState.PLAYING){b.fire("play",x)}if(x.data===YT.PlayerState.PAUSED){b.fire("pause",x)}if(x.data===YT.PlayerState.ENDED){b.fire("end",x)}if(b.options.endTime){if(x.data===YT.PlayerState.PLAYING){h=setInterval(function(){if(b.options.endTime&&b.player.getCurrentTime()>=b.options.endTime){if(b.options.loop){b.play(b.options.startTime)}else{b.pause()}}},150)}else{clearInterval(h)}}}};var k=!b.$iframe;if(k){var g=document.createElement("div");g.setAttribute("id",b.playerID);c.appendChild(g);document.body.appendChild(c)}b.player=b.player||new p.YT.Player(b.playerID,b.playerOptions);if(k){b.$iframe=document.getElementById(b.playerID);b.videoWidth=parseInt(b.$iframe.getAttribute("width"),10)||1280;b.videoHeight=parseInt(b.$iframe.getAttribute("height"),10)||720}}if(b.type==="vimeo"){b.playerOptions="";b.playerOptions+="player_id="+b.playerID;b.playerOptions+="&autopause=0";if(!b.options.controls){b.playerOptions+="&badge=0&byline=0&portrait=0&title=0"}b.playerOptions+="&autoplay="+(b.options.autoplay?"1":"0");b.playerOptions+="&loop="+(b.options.loop?1:0);if(!b.$iframe){b.$iframe=document.createElement("iframe");b.$iframe.setAttribute("id",b.playerID);b.$iframe.setAttribute("src","https://player.vimeo.com/video/"+b.videoID+"?"+b.playerOptions);b.$iframe.setAttribute("frameborder","0");c.appendChild(b.$iframe);document.body.appendChild(c)}b.player=b.player||new Vimeo.Player(b.$iframe);b.player.getVideoWidth().then(function(x){b.videoWidth=x||1280});b.player.getVideoHeight().then(function(x){b.videoHeight=x||720});if(b.options.startTime&&b.options.autoplay){b.player.setCurrentTime(b.options.startTime)}b.player.setVolume(b.options.mute?0:100);var j;b.player.on("timeupdate",function(x){if(!j){b.fire("started",x)}j=1;if(b.options.endTime){if(b.options.endTime&&x.seconds>=b.options.endTime){if(b.options.loop){b.play(b.options.startTime)}else{b.pause()}}}});b.player.on("play",function(x){b.fire("play",x);if(b.options.startTime&&x.seconds===0){b.play(b.options.startTime)}});b.player.on("pause",function(x){b.fire("pause",x)});b.player.on("ended",function(x){b.fire("end",x)});b.player.on("loaded",function(x){b.fire("ready",x)})}function e(B,C,A){var D=document.createElement("source");D.src=C;D.type=A;B.appendChild(D)}if(b.type==="local"){if(!b.$iframe){b.$iframe=document.createElement("video");if(b.options.mute){b.$iframe.muted=true}if(b.options.loop){b.$iframe.loop=true}b.$iframe.setAttribute("id",b.playerID);c.appendChild(b.$iframe);document.body.appendChild(c);for(var f in b.videoID){e(b.$iframe,b.videoID[f],"video/"+f)}}b.player=b.player||b.$iframe;var d;t(b.player,"playing",function(x){if(!d){b.fire("started",x)}d=1});t(b.player,"timeupdate",function(){if(b.options.endTime){if(b.options.endTime&&this.currentTime>=b.options.endTime){if(b.options.loop){b.play(b.options.startTime)}else{b.pause()}}}});t(b.player,"play",function(x){b.fire("play",x)});t(b.player,"pause",function(x){b.fire("pause",x)});t(b.player,"ended",function(x){b.fire("end",x)});t(b.player,"loadedmetadata",function(){b.videoWidth=this.videoWidth||1280;b.videoHeight=this.videoHeight||720;b.fire("ready");if(b.options.autoplay){b.play(b.options.startTime)}})}a(b.$iframe)})};r.prototype.init=function(){var a=this;a.playerID="VideoWorker-"+a.ID};var q=0;var l=0;r.prototype.loadAPI=function(){var c=this;if(q&&l){return}var d="";if(c.type==="youtube"&&!q){q=1;d="//www.youtube.com/iframe_api"}if(c.type==="vimeo"&&!l){l=1;d="//player.vimeo.com/api/player.js"}if(!d){return}if(p.location.origin==="file://"){d="http:"+d}var b=document.createElement("script");var a=document.getElementsByTagName("head")[0];b.src=d;a.appendChild(b);a=null;b=null};var m=0;var v=0;var u=new n();var s=new n();r.prototype.onAPIready=function(c){var a=this;if(a.type==="youtube"){if((typeof YT==="undefined"||YT.loaded===0)&&!m){m=1;p.onYouTubeIframeAPIReady=function(){p.onYouTubeIframeAPIReady=null;u.resolve("done");c()}}else{if(typeof YT==="object"&&YT.loaded===1){c()}else{u.done(function(){c()})}}}if(a.type==="vimeo"){if(typeof Vimeo==="undefined"&&!v){v=1;var b=setInterval(function(){if(typeof Vimeo!=="undefined"){clearInterval(b);s.resolve("done");c()}},20)}else{if(typeof Vimeo!=="undefined"){c()}else{s.done(function(){c()})}}}if(a.type==="local"){c()}};p.VideoWorker=r}(window));
/*!
 * Name    : Video Background Extension for Jarallax
 * Version : 1.0.0
 * Author  : _nK http://nkdev.info
 * GitHub  : https://github.com/nk-o/jarallax
 */
(function(){if(typeof jarallax==="undefined"){return}var g=jarallax.constructor;var f=g.prototype.init;g.prototype.init=function(){var a=this;f.apply(a);if(a.video){a.video.getIframe(function(c){var b=c.parentNode;a.css(c,{position:a.image.position,top:"0px",left:"0px",right:"0px",bottom:"0px",width:"100%",height:"100%",maxWidth:"none",maxHeight:"none",visibility:"hidden",margin:0,zIndex:-1});a.$video=c;a.image.$container.appendChild(c);b.parentNode.removeChild(b)})}};var h=g.prototype.coverImage;g.prototype.coverImage=function(){var a=this;h.apply(a);if(a.video&&a.image.$item.nodeName==="IFRAME"){a.css(a.image.$item,{height:a.image.$item.getBoundingClientRect().height+400+"px",marginTop:(-200+parseFloat(a.css(a.image.$item,"margin-top")))+"px"})}};var i=g.prototype.initImg;g.prototype.initImg=function(){var a=this;var b=i.apply(a);if(!a.options.videoSrc){a.options.videoSrc=a.$item.getAttribute("data-jarallax-video")||false}if(a.options.videoSrc){var c=new VideoWorker(a.options.videoSrc,{startTime:a.options.videoStartTime||0,endTime:a.options.videoEndTime||0});if(c.isValid()){a.image.useImgTag=true;c.on("ready",function(){var d=a.onScroll;a.onScroll=function(){d.apply(a);if(a.isVisible()){c.play()}else{c.pause()}}});c.on("started",function(){a.image.$default_item=a.image.$item;a.image.$item=a.$video;a.image.width=a.options.imgWidth=a.video.videoWidth||1280;a.image.height=a.options.imgHeight=a.video.videoHeight||720;a.coverImage();a.clipContainer();a.onScroll();if(a.image.$default_item){a.image.$default_item.style.display="none"}});a.video=c;if(c.type!=="local"){c.getImageURL(function(d){a.image.src=d;a.init()})}}if(c.type!=="local"){return false}else{if(!b){a.image.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";return true}}}return b};var j=g.prototype.destroy;g.prototype.destroy=function(){var a=this;j.apply(a)}}());